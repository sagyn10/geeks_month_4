{% extends 'base.html' %}
{% block content %}
<h2>Список фильмов</h2>
{% if user.is_authenticated %}
  <p><a href="{% url 'CineBoard:movie_add' %}">Добавить фильм</a></p>
{% endif %}
<form method="get">
  <input type="text" name="q" value="{{ request.GET.q }}" placeholder="Поиск...">
  <button type="submit">Найти</button>
  <a href="?sort=rating">Сортировать по рейтингу</a>
</form>
<p>Жанры:
  <a href="?">Все</a>
  {% for g in genres %}
    | <a href="?genre={{ g.slug }}">#{{ g.name }}</a>
  {% endfor %}
</p>
<ul>
  {% for movie in movies %}
    <li class="book-card">
      {% if movie.image %}
        <img src="{{ movie.image.url }}" alt="{{ movie.title }}" style="width:100%; height:300px; object-fit:cover; border-radius:5px;">
      {% else %}
        <div style="width:100%; height:300px; display:flex; align-items:center; justify-content:center; background:#2a2a2a; border-radius:5px; color:#bbb;">
          <span style="padding:10px; text-align:center;">Без обложки</span>
        </div>
      {% endif %}
      <h3 style="color:#fff; text-align:center;">{{ movie.title }}{% if movie.year %} ({{ movie.year }}){% endif %}</h3>
      <p style="color:#bbb;">{{ movie.description|truncatewords:20 }}</p>
      <div style="text-align:center;">
        <a href="{% url 'CineBoard:movie_detail' movie.pk %}" class="btn btn-add">Подробнее</a>
      </div>
      {% if movie.avg_rating %}
        <p style="color:#fff; text-align:center;">Рейтинг: {{ movie.avg_rating|floatformat:1 }}</p>
      {% endif %}
      {% if user.is_authenticated %}
        <div style="text-align:center;">
          <a href="{% url 'CineBoard:movie_edit' movie.pk %}" class="btn btn-edit">Изменить</a>
          <a href="{% url 'CineBoard:movie_delete' movie.pk %}" class="btn btn-delete">Удалить</a>
        </div>
      {% endif %}
    </li>
  {% empty %}
    <li>Фильмы отсутствуют.</li>
  {% endfor %}
</ul>
{% endblock %}
